<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="HarvestHive" />
    <title>CekPangan | Website Prediksi Harga Pangan</title>

    <!-- Favicon-->
    <link rel="icon" type="image/png" href="assets/img/logo-hd.png" />

    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .banner-image {
            background-image: url(assets/img/bg-1.jpg);
            background-size: cover;
        }
    </style>
</head>

<body>
    <!-- Responsive navbar-->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark p-md-3 ">
        <div class="container">
            <a><img class="logo d-flex align-items-center me-auto" src="assets/img/logo-hd1.png"></a>
            <a class="navbar-brand " href="CekPangan.html"><h2>CekPangan</h2></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navbar"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link rounded-bottom active bg-gradients" href="CekPangan.html#home">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link rounded-bottom active " href="CekPangan.html#prediksi">Tabel Harga</a></li>
                    <li class="nav-item"><a class="nav-link rounded-bottom active " href="CekPangan.html#profil">Profil</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="home" class="banner-image w-100 vh-100 d-flex justify-content-center align-items-center">
        <div class="content text-center">
            <h1 class="text-white">Selamat Datang di CekPangan!</h1>
            <p class="lead mb-0 text-white" style="font-size: 23px;"><span class="fw-bold">CekPangan</span> adalah platform inovatif yang dirancang untuk membantu masyarakat memantau<br> dan memprediksi harga pangan dalam satu bulan ke depan dengan akurasi tinggi. Kami menggunakan<br> metode <span class="fw-bold">Long Short-Term Memory (LSTM)</span>. Dengan memanfaatkan data historis dan algoritma<br> canggih, CekPangan memberikan perkiraan harga yang dapat membantu konsumen dan pelaku<br> bisnis dalam membuat keputusan yang lebih tepat terkait kebutuhan pangan mereka.</p>
        </div>
    </section>

    <!-- Page content-->
    <section id="prediksi">
        <div class="container">
            <h2 class="fw-bolder my-4 text-blue">Prediksi Harga <br> Bahan Pangan</h2>
            <div class="card mb-4 shadow ">
                <form id="prediction-form">
                    <div class="row">
                  
                    <div class="col-sm mx-3 mt-2">
                        <p>
                            <label class="fw-bold">Provinsi</label>
                            <br>
                            <select class="form-select" id="provinsi" name="provinsi">
                                <option value="1">Aceh</option>
                                <option value="2">Sumatera Utara</option>
                                <option value="3">Sumatera Barat</option>
                                <option value="4">Riau</option>
                                <option value="5">Jambi</option>
                                <option value="6">Sumatera Selatan</option>
                                <option value="7">Bengkulu</option>
                                <option value="8">Lampung</option>
                                <option value="9">Bangka Belitung</option>
                                <option value="10">Kep. Riau</option>
                            </select>
                        </p>
                    </div>
                
                    <div class="col-sm mx-3 mt-2">
                        <p>
                            <label class="fw-bold">Komoditas</label>
                            <br>
                            <select class="form-select" id="komoditas" name="komoditas">
                                <option value="beras_medium">Beras Medium</option>
                                <option value="bawang_merah">Bawang Merah</option>
                                <option value="bawang_putih_bonggol">Bawang Putih Bonggol</option>
                                <option value="cabai_merah_keriting">Cabai Merah Keriting</option>
                                <option value="telur_ayam_ras">Telur Ayam Ras</option>
                                <option value="gula_konsumsi">Gula Konsumsi</option>
                                <option value="minyak_goreng_kemasan_sederhana">Minyak Goreng Kemasan Sederhana</option>
                            </select>
                        </p>
                    </div>
                </div>
            </form>
            
                <div class="container">
                    <div class="row my-2 justify-content-sm-center text-black fw-semibold">
                        <div class="col-lg">
                            <div class="table-wrap"> 
                                <table class="table table-striped" id="tabel-prediksi">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Harga</th>
                                            <th>Prediksi Harga</th>
                                            <th>Akurasi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                            
                            <table class="table table-info" id="rata-rata">
                                <tbody>

                                </tbody>
                            </table>
                        </div>    
                        <div class="col-lg">
                            <div class="card">
                                <div class="card-body">
                                    <canvas id="myChart" style="height: 350px;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>  
    </section>

    <section id="profil">
        <div class="container">
            <h2 class="fw-bolder my-2 text-center text-blue">Team</h2>
            <div class="row">
                <div class="col-lg">
                    <div class="card mb-3">
                        <a><img class="card-img-top card-img-bottom" src="assets/img/della.png" alt="..."></a>
                    </div>
                    <div class="text-blue">
                        <h5 class="card-title">Della Adelia</h5>
                        <p class="text-muted">Data Analyst <br>della.210170051@mhs.unimal.ac.id</p>
                        <p class="text-center text-black fw-bold">"Bismillah lulus tanpa skripsi"</p>
                    </div>
                </div>
                <div class="col-lg">
                    <div class="card mb-4">
                        <a><img class="card-img-top card-img-bottom" src="assets/img/fathur.png" alt="..."></a>
                    </div>
                    <div class="text-blue">
                        <h5 class="card-title">Muhammad Fathurrahman</h5>
                        <p class="text-muted">Web Developer <br>muhammad.220170212@mhs.unimal.ac.id</p>
                        <p class="text-center text-black fw-bold">"Ga tau, males, pengen ke Semarang..."</p>
                    </div>
                </div>
                <div class="col-lg">
                    <div class="card mb-4">
                        <a><img class="card-img-top card-img-bottom" src="assets/img/reza.png" alt="..."></a>
                    </div>
                    <div class="text-blue">
                        <h5 class="card-title">Reza Dwi Putri</h5>
                        <p class="text-muted">Data Analyst <br>reza.210170061@mhs.unimal.ac.id</p>
                        <p class="text-center text-black fw-bold">"Juara, Juara, Juara"</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scroll Top -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

    <!-- Footer-->
    <footer class="py-5 bg-blue">
        <div class="container">
            <p class="m-0 text-center text-white">Copyright &copy; The HarvestHive 2024<br>Malikussaleh University</p>
            <p class="m-0 text-center text-white">Powered by advanced Long Short-Term Memory (LSTM) technology for accurate and reliable food price predictions.</p>
        </div>
    </footer>
    
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/scripts.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        var nav = document.querySelector('nav');

        window.addEventListener('scroll', function(){
            if(window.pageYOffset > 100){
                nav.classList.add('bg-blue', 'shadow');
            } else {
                nav.classList.remove('bg-blue', 'shadow');
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const provinsiSelect = document.getElementById('provinsi');
            const komoditasSelect = document.getElementById('komoditas');
            const apiEndpointPredict = 'http://127.0.0.1:5000/predict';
            const apiEndpointPlot = 'http://127.0.0.1:5000/plot';
            let chartInstance; // Variable to hold the chart instance

            async function sendFormData() {
                const formData = {
                    provinsi: parseInt(provinsiSelect.value),
                    komoditas: komoditasSelect.value,
                    future_day: 30
                };

                console.log('Sending data:', formData); // Debugging: print the data to console

                try {
                    const [responsePredict, responsePlot] = await Promise.all([
                        fetch(apiEndpointPredict, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        }),
                        fetch(apiEndpointPlot, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        })
                    ]);

                    if (!responsePredict.ok) {
                        throw new Error('Network response was not ok for /predict');
                    }
                    if (!responsePlot.ok) {
                        throw new Error('Network response was not ok for /plot');
                    }

                    const data = await responsePredict.json();
                    const dataPlot = await responsePlot.json();

                    console.log('Response from /predict:', data); // Debugging: print the response to console
                    console.log('Response from /plot:', dataPlot); // Debugging: print the response to console

                    if (data.predictions) {
                        // Update predictions table
                        const tableBody = document.getElementById('tabel-prediksi').getElementsByTagName('tbody')[0];
                        tableBody.innerHTML = ''; // Clear table before adding new data

                        data.predictions.forEach(prediction => {
                            const formattedDate = new Date(prediction.tanggal).toLocaleDateString('en-GB');
                            const prediksiBulat = parseInt(prediction[formData.komoditas + '_prediksi']);
                            const row = `<tr>
                                <td>${formattedDate}</td>
                                <td>Rp.${prediction[formData.komoditas + '_real']}</td>
                                <td>Rp.${prediksiBulat}</td>
                                <td>${prediction.akurasi}%</td>
                            </tr>`;
                            tableBody.insertAdjacentHTML('beforeend', row);
                        });

                            // Update average RMSE and accuracy table
                            const averageRow = `<tr>
                            <td>Rata-Rata Akurasi</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td> 
                            <td>${data.accuracy.accuracy_mean}%</td>
                        </tr>`;
                        document.getElementById('rata-rata').getElementsByTagName('tbody')[0].innerHTML = averageRow;
                    }

                    // Render or update the chart with data from /plot
                    renderChart(dataPlot.predictions, formData.komoditas);

                }catch (error) {
                        console.error('Error:', error);
                    }
            }

            function renderChart(predictions, komoditas) {
                myLineChart.data.datasets[0].data = predictions.map(item => item[komoditas + '_real']);
                myLineChart.data.datasets[0].order = 2;

                myLineChart.data.datasets[1].data = predictions.map(item => item[komoditas + '_prediksi']);
                myLineChart.data.datasets[1].order = 1;

                myLineChart.data.labels = Array.from({ length: predictions.length }, (_, i) => String(i + 1).padStart(2, '0'));
                myLineChart.update();
            }

            // Event listeners for form inputs
            provinsiSelect.addEventListener('change', sendFormData);
            komoditasSelect.addEventListener('change', sendFormData);

            // Initial chart rendering
            sendFormData();
        });

    </script>

    <script>
        var ctx = document.getElementById('myChart');
    
        var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: 'Harga Asli',
                    data: [],
                    borderWidth: 2
                },
                {
                    label: 'Prediksi Harga',
                    data: [],
                    borderWidth: 2
                },
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: false  
                }
            }
        }
        });
    </script>

</body>
</html>
